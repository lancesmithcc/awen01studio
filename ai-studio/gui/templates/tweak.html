<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>AWEN01 · Tweak</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        font-family: "Jost", sans-serif;
      }
      :root {
        color-scheme: dark;
        font-family: "Jost", sans-serif;
        background: #0a1a1a;
        color: #b8ffe8;
      }
      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        padding: 3rem 1rem;
        position: relative;
        overflow: hidden;
      }
      #flower-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
      }
      .panel {
        width: min(620px, 100%);
        background: #152a2a;
        border: 1px solid #2a5a5a;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 20px 60px rgba(0, 255, 170, 0.15);
        position: relative;
        z-index: 1;
      }
      h1 {
        margin: 0 0 0.5rem;
        letter-spacing: 0.2rem;
        text-transform: uppercase;
        font-family: "Jost", sans-serif;
        color: #a8f5e8;
      }
      p {
        margin: 0 0 1.5rem;
        color: #6dd4a8;
        font-family: "Jost", sans-serif;
      }
      label {
        display: block;
        text-transform: uppercase;
        letter-spacing: 0.1rem;
        font-size: 0.8rem;
        color: #6dd4a8;
        margin-bottom: 0.25rem;
        font-family: "Jost", sans-serif;
      }
      textarea,
      input {
        width: 100%;
        border-radius: 12px;
        border: 1px solid #1a4a4a;
        background: #0d1f1f;
        color: inherit;
        font-size: 1rem;
        padding: 0.75rem;
        box-sizing: border-box;
        margin-bottom: 1rem;
        font-family: "Jost", sans-serif;
      }
      textarea {
        min-height: 140px;
      }
      button {
        width: 100%;
        border: none;
        border-radius: 999px;
        padding: 0.75rem;
        font-size: 1rem;
        background: linear-gradient(120deg, #00cc66, #00ffaa);
        color: #0a1a1a;
        text-transform: uppercase;
        letter-spacing: 0.1rem;
        cursor: pointer;
        font-family: "Jost", sans-serif;
        font-weight: 500;
      }
      .status {
        margin-top: 0.75rem;
        color: #6dd4a8;
        min-height: 1.2rem;
        font-size: 0.9rem;
        font-family: "Jost", sans-serif;
      }
      a {
        color: #4dd4c4;
        font-family: "Jost", sans-serif;
      }
    </style>
  </head>
  <body>
    <canvas id="flower-canvas"></canvas>
    <div class="panel">
      <h1>AWEN01 Settings</h1>
      <p>Adjust the system prompt, temperature, and stop tokens. Changes apply instantly.</p>

      <label for="system-prompt">System Prompt</label>
      <textarea id="system-prompt"></textarea>

      <label for="temperature">Temperature</label>
      <input id="temperature" type="number" step="0.05" min="0" max="2" />

      <label for="stop">Stop Tokens (comma-separated)</label>
      <input id="stop" placeholder="e.g. USER:,Assistant:" />

      <label for="max-tokens">Max Tokens</label>
      <input id="max-tokens" type="number" min="16" max="4096" />

      <button id="save-btn">Save</button>
      <div class="status" id="status"></div>
      <p>
        <a href="/ui">Back to Chat</a>
      </p>
    </div>

    <script>
      const systemPromptEl = document.getElementById("system-prompt");
      const temperatureEl = document.getElementById("temperature");
      const stopEl = document.getElementById("stop");
      const maxTokensEl = document.getElementById("max-tokens");
      const statusEl = document.getElementById("status");
      const saveBtn = document.getElementById("save-btn");

      async function loadSettings() {
        const res = await fetch("/settings");
        if (!res.ok) {
          statusEl.textContent = "Unable to load settings.";
          return;
        }
        const data = await res.json();
        systemPromptEl.value = data.system_prompt || "";
        temperatureEl.value = data.temperature ?? 0.6;
        stopEl.value = (data.stop || []).join(", ");
        maxTokensEl.value = data.max_tokens ?? 512;
      }

      async function saveSettings() {
        const payload = {
          system_prompt: systemPromptEl.value.trim(),
          temperature: parseFloat(temperatureEl.value) || 0.6,
          stop: stopEl.value
            .split(",")
            .map((item) => item.trim())
            .filter(Boolean),
          max_tokens: parseInt(maxTokensEl.value, 10) || 512
        };

        saveBtn.disabled = true;
        statusEl.textContent = "Saving…";

        const res = await fetch("/settings", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const err = await res.text();
          statusEl.textContent = err || "Error saving settings.";
        } else {
          statusEl.textContent = "Saved.";
        }
        saveBtn.disabled = false;
      }

      saveBtn.addEventListener("click", saveSettings);
      loadSettings().catch(() => (statusEl.textContent = "Unable to load settings."));

      // Flower of Life Lattice Animation
      (function() {
        const canvas = document.getElementById("flower-canvas");
        const ctx = canvas.getContext("2d");
        let animationFrame = 0;
        let time = 0;

        function resizeCanvas() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }

        function drawCircle(x, y, radius, alpha = 1) {
          ctx.beginPath();
          ctx.arc(x, y, radius, 0, Math.PI * 2);
          ctx.globalAlpha = alpha;
          ctx.stroke();
          ctx.globalAlpha = 1;
        }

        function drawFlowerOfLife(centerX, centerY, radius, timeOffset) {
          // Classic flower of life pattern with overlapping circles
          const circles = [];
          
          // Center circle
          circles.push({ x: centerX, y: centerY, r: radius });
          
          // First ring - 6 circles around center (60 degrees apart)
          for (let i = 0; i < 6; i++) {
            const angle = (Math.PI / 3) * i;
            const x = centerX + radius * Math.cos(angle);
            const y = centerY + radius * Math.sin(angle);
            circles.push({ x, y, r: radius });
          }
          
          // Second ring - 6 circles at 60-degree positions
          for (let i = 0; i < 6; i++) {
            const angle = (Math.PI / 3) * i;
            const x = centerX + radius * 2 * Math.cos(angle);
            const y = centerY + radius * 2 * Math.sin(angle);
            circles.push({ x, y, r: radius });
          }
          
          // Additional circles to form the hexagonal lattice
          // These connect the outer circles
          for (let i = 0; i < 6; i++) {
            const angle1 = (Math.PI / 3) * i;
            const angle2 = (Math.PI / 3) * (i + 1);
            const x1 = centerX + radius * 2 * Math.cos(angle1);
            const y1 = centerY + radius * 2 * Math.sin(angle1);
            const x2 = centerX + radius * 2 * Math.cos(angle2);
            const y2 = centerY + radius * 2 * Math.sin(angle2);
            const midX = (x1 + x2) / 2;
            const midY = (y1 + y2) / 2;
            const dist = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            if (dist > radius * 0.5) {
              circles.push({ x: midX, y: midY, r: radius });
            }
          }
          
          // Draw all circles with morphing effect
          const morph = 0.8 + 0.2 * Math.sin(time * 0.3 + timeOffset);
          const rotation = time * 0.05 + timeOffset * 0.1;
          
          circles.forEach((circle, idx) => {
            const alpha = 0.15 + 0.1 * Math.sin(time * 0.4 + idx * 0.2);
            const r = circle.r * morph;
            
            // Apply rotation around center
            const dx = circle.x - centerX;
            const dy = circle.y - centerY;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) + rotation;
            const x = centerX + dist * Math.cos(angle);
            const y = centerY + dist * Math.sin(angle);
            
            drawCircle(x, y, r, alpha);
          });
        }

        function animate() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          
          // Green aurora gradient effect
          const gradient = ctx.createRadialGradient(
            canvas.width / 2,
            canvas.height / 2,
            0,
            canvas.width / 2,
            canvas.height / 2,
            Math.max(canvas.width, canvas.height)
          );
          gradient.addColorStop(0, "rgba(0, 255, 170, 0.05)");
          gradient.addColorStop(0.5, "rgba(0, 204, 102, 0.03)");
          gradient.addColorStop(1, "rgba(0, 255, 170, 0.01)");
          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          
          // Set stroke style with green aurora colors
          const hue = (time * 10) % 360;
          const baseGreen = `rgba(0, 255, 170, 0.4)`;
          const auroraGreen = `rgba(109, 212, 168, 0.3)`;
          ctx.strokeStyle = baseGreen;
          ctx.lineWidth = 1;
          ctx.shadowBlur = 10;
          ctx.shadowColor = "rgba(0, 255, 170, 0.5)";
          
          time += 0.008;
          
          // Draw tiled flower of life patterns
          const patternSize = 200;
          const cols = Math.ceil(canvas.width / patternSize) + 2;
          const rows = Math.ceil(canvas.height / patternSize) + 2;
          
          for (let row = -1; row < rows; row++) {
            for (let col = -1; col < cols; col++) {
              // Hexagonal tiling offset
              const offsetX = col * patternSize * 1.5;
              const offsetY = row * patternSize * Math.sqrt(3) + (col % 2 === 0 ? 0 : patternSize * Math.sqrt(3) / 2);
              const timeOffset = (row + col) * 0.3;
              
              // Subtle parallax movement
              const parallaxX = Math.sin(time * 0.2 + timeOffset) * 15;
              const parallaxY = Math.cos(time * 0.15 + timeOffset) * 10;
              
              drawFlowerOfLife(
                offsetX + parallaxX,
                offsetY + parallaxY,
                40,
                timeOffset
              );
            }
          }
          
          ctx.shadowBlur = 0;
          animationFrame = requestAnimationFrame(animate);
        }

        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);
        animate();
      })();
    </script>
  </body>
</html>
